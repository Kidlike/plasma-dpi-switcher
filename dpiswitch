#! /usr/bin/env python3

import argparse
import os
import sys

from utils import load_config_file, get_default_config_filename, find_profile, prompt_for_profile, validator, plasma

parser = argparse.ArgumentParser(description="Command-line KDE Plasma DPI change utility")
parser.add_argument('--profile')
parser.add_argument('--config', default=get_default_config_filename())
parser.add_argument('--no-logout', action='store_true', help="Do not end current desktop session")

args = parser.parse_args()
try:
    validator.assert_valid_config(args.config, os.path.join(sys.path[0], 'schema.json'))
    config = load_config_file(args.config)

    profilename = args.profile if args.profile is not None else prompt_for_profile(config)
    profile = find_profile(config, profilename)

    if profile is None:
        raise Exception("Unable to find profile {}".format(profile))

    plasma.apply_profile(profile)

    if not args.no_logout:
        plasma.session_end()
except Exception as e:
    print("[ERR] {}".format(e))
    exit(1)
